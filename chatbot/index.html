<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chatbot</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">AI</div>
        <div>
          <h1>Mini Chatbot</h1>
          <p>Talk with AI through proxy</p>
        </div>
      </div>
      <button class="btn" id="clearBtn">Clear</button>
    </header>

    <main class="chat">
      <div class="messages" id="messages"></div>

      <div class="composer">
        <textarea id="prompt" placeholder="Type your message..."></textarea>
        <button class="btn" id="sendBtn">Send</button>
      </div>
    </main>
  </div>

  <script>
  const API_URL = "http://10.21.123.251:3000/api/chat";

  const messagesEl = document.getElementById("messages");
  const promptEl = document.getElementById("prompt");
  const sendBtn = document.getElementById("sendBtn");
  const clearBtn = document.getElementById("clearBtn");

  function pushMessage(role, text) {
    const div = document.createElement("div");
    div.className = "msg " + (role === "user" ? "user" : "bot");
    div.textContent = text;
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  async function typeText(container, text) {
    container.textContent = "";
    for (let i = 0; i < text.length; i++) {
      container.textContent += text[i];
      messagesEl.scrollTop = messagesEl.scrollHeight;
      await new Promise((r) => setTimeout(r, 15));
    }
  }

  async function callAPI(prompt) {
    pushMessage("user", prompt);

    const typingDiv = document.createElement("div");
    typingDiv.className = "msg bot";
    typingDiv.textContent = "AI is typing...";
    messagesEl.appendChild(typingDiv);

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt }),
      });

      const data = await res.json();

      // Extract Gemini reply from your backend response
      const reply =
        data?.candidates?.[0]?.content?.parts?.[0]?.text ||
        data?.reply ||
        "No response";

      typingDiv.textContent = "";
      await typeText(typingDiv, reply);
    } catch (err) {
      typingDiv.textContent = "Error: " + err.message;
    }
  }

  sendBtn.onclick = () => {
    const text = promptEl.value.trim();
    if (!text) return;
    promptEl.value = "";
    callAPI(text);
  };

  promptEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendBtn.click();
    }
  });

  clearBtn.onclick = () => (messagesEl.innerHTML = "");
  </script>
</body>
</html>
